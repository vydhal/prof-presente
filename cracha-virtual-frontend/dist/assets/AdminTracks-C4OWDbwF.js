import{o as Q,r as o,p as E,q as P,j as e,B as c,c as N,aJ as m,v as w,h as $}from"./index-D96FZGJW.js";import{I as A}from"./input-DDdIEpJM.js";import{T as G}from"./textarea-CEySCzb7.js";import{C as H}from"./card-DGXvG8EM.js";import{T as J,a as K,b as h,c as u,d as V,e as i}from"./table-S3G5nGeW.js";import{D as W,b as _,c as X,d as Y,f as Z}from"./dialog-Bl-WjPsE.js";import{B as F}from"./badge-B3h_Dmat.js";import{P as U}from"./plus-dvmosiY5.js";import{L as ee}from"./link-Bf-7QkUf.js";import{P as se}from"./pencil-D660FB7z.js";import{T as ae}from"./trash-2-CO8yHHry.js";const ue=()=>{const y=Q(),[L,p]=o.useState(!1),[n,g]=o.useState(null),[T,b]=o.useState(null),[D,f]=o.useState(null),[l,d]=o.useState({title:"",description:"",imageUrl:"",eventIds:[]}),{data:r,isLoading:B}=E({queryKey:["admin-tracks"],queryFn:async()=>{const s=await m.getAll();return Array.isArray(s.data)?s.data:[]}}),{data:j,isLoading:q}=E({queryKey:["admin-events-list"],queryFn:async()=>(await $.getAll({limit:100})).data.events}),v=P({mutationFn:s=>n?m.update(n.id,s):m.create(s),onSuccess:()=>{y.invalidateQueries(["admin-tracks"]),w.success(n?"Trilha atualizada!":"Trilha criada!"),C()},onError:s=>{var t,x,S,I;const a=(x=(t=s.response)==null?void 0:t.data)!=null&&x.details?`${s.response.data.error}: ${s.response.data.details}`:((I=(S=s.response)==null?void 0:S.data)==null?void 0:I.error)||"Erro ao salvar trilha";w.error(a)}}),R=P({mutationFn:s=>m.delete(s),onSuccess:()=>{y.invalidateQueries(["admin-tracks"]),w.success("Trilha removida!")}}),k=(s=null)=>{var a;s?(g(s),d({title:s.title,description:s.description,imageUrl:s.imageUrl||"",eventIds:((a=s.events)==null?void 0:a.map(t=>t.eventId))||[]})):(g(null),d({title:"",description:"",imageUrl:"",eventIds:[]}),b(null),f(null)),p(!0)},M=s=>{const a=s.target.files[0];if(a){b(a);const t=new FileReader;t.onloadend=()=>{f(t.result)},t.readAsDataURL(a)}},C=()=>{p(!1),g(null),b(null),f(null)},O=s=>{s.preventDefault();const a=new FormData;a.append("title",l.title),a.append("description",l.description),a.append("eventIds",JSON.stringify(l.eventIds)),T?a.append("trackThumbnail",T):l.imageUrl&&a.append("imageUrl",l.imageUrl),v.mutate(a)},z=s=>{d(a=>a.eventIds.includes(s)?{...a,eventIds:a.eventIds.filter(x=>x!==s)}:{...a,eventIds:[...a.eventIds,s]})};return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-slate-900 dark:text-white uppercase tracking-tight",children:"Gerenciar Trilhas"}),e.jsx("p",{className:"text-slate-500",children:"Crie e organize trilhas de formação continuada."})]}),e.jsxs(c,{onClick:()=>k(),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl px-6",children:[e.jsx(U,{className:"w-5 h-5 mr-2"})," Nova Trilha"]})]}),e.jsx(H,{className:"border-slate-200 dark:border-slate-800 overflow-hidden rounded-2xl",children:e.jsxs(J,{children:[e.jsx(K,{className:"bg-slate-50 dark:bg-slate-900/50",children:e.jsxs(h,{children:[e.jsx(u,{className:"font-bold",children:"Trilha"}),e.jsx(u,{className:"font-bold",children:"Eventos"}),e.jsx(u,{className:"font-bold",children:"Criada em"}),e.jsx(u,{className:"text-right font-bold",children:"Ações"})]})}),e.jsx(V,{children:B?e.jsx(h,{children:e.jsx(i,{colSpan:4,className:"text-center py-10",children:e.jsx(N,{className:"w-8 h-8 animate-spin mx-auto text-blue-500"})})}):(r==null?void 0:r.length)===0?e.jsx(h,{children:e.jsx(i,{colSpan:4,className:"text-center py-10 text-slate-500 italic",children:"Nenhuma trilha cadastrada."})}):r==null?void 0:r.map(s=>e.jsxs(h,{className:"group hover:bg-slate-50 dark:hover:bg-slate-900/40 transition-colors",children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-slate-100 dark:bg-slate-800 overflow-hidden flex-shrink-0",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,className:"w-full h-full object-cover",alt:""}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:e.jsx(ee,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white",children:s.title}),e.jsx("div",{className:"text-xs text-slate-500 line-clamp-1 max-w-xs",children:s.description})]})]})}),e.jsx(i,{children:e.jsxs(F,{variant:"secondary",className:"font-bold",children:[s._count.events," Etapas"]})}),e.jsx(i,{className:"text-slate-500 text-sm",children:new Date(s.createdAt).toLocaleDateString("pt-BR")}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>k(s),className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-900/20",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{confirm("Deseja realmente excluir esta trilha?")&&R.mutate(s.id)},className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-900/20",children:e.jsx(ae,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx(W,{open:L,onOpenChange:p,children:e.jsxs(_,{className:"max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl sm:rounded-3xl",children:[e.jsx(X,{children:e.jsx(Y,{className:"text-2xl font-black",children:n?"Editar Trilha":"Nova Trilha"})}),e.jsxs("form",{onSubmit:O,className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Título"}),e.jsx(A,{value:l.title,onChange:s=>d({...l,title:s.target.value}),placeholder:"Ex: Formação em IA para Professores",className:"rounded-xl border-slate-200",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Descrição"}),e.jsx(G,{value:l.description,onChange:s=>d({...l,description:s.target.value}),placeholder:"Descreva o objetivo da trilha...",className:"rounded-xl border-slate-200 min-h-[100px]",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Imagem da Trilha (Opcional)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[(D||l.imageUrl)&&e.jsx("div",{className:"w-20 h-20 rounded-xl overflow-hidden border-2 border-slate-100 flex-shrink-0",children:e.jsx("img",{src:D||l.imageUrl,className:"w-full h-full object-cover",alt:"Preview"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(A,{type:"file",onChange:M,accept:"image/*",className:"rounded-xl border-slate-200 cursor-pointer file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"PNG, JPG ou WEBP até 5MB."})]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:["Vincular Eventos (",l.eventIds.length,")"]})}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-800 rounded-2xl overflow-hidden",children:e.jsx("div",{className:"max-h-[300px] overflow-y-auto divide-y divide-slate-100 dark:divide-slate-800",children:q?e.jsx("div",{className:"p-8 text-center",children:e.jsx(N,{className:"w-6 h-6 animate-spin mx-auto text-blue-500"})}):j==null?void 0:j.map(s=>{const a=l.eventIds.includes(s.id);return e.jsxs("div",{onClick:()=>z(s.id),className:`p-4 flex items-center justify-between cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors ${a?"bg-blue-50/50 dark:bg-blue-900/10":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 transition-all flex items-center justify-center ${a?"bg-blue-600 border-blue-600":"border-slate-300 dark:border-slate-700"}`,children:a&&e.jsx(U,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold line-clamp-1",children:s.title}),e.jsx("div",{className:"text-xs text-slate-500",children:new Date(s.startDate).toLocaleDateString("pt-BR")})]})]}),a&&e.jsx(F,{className:"bg-blue-600 text-white border-none text-[10px]",children:"Selecionado"})]},s.id)})})})]})]}),e.jsxs(Z,{className:"gap-2 sm:gap-0",children:[e.jsx(c,{type:"button",variant:"ghost",onClick:C,className:"rounded-xl font-bold",children:"Cancelar"}),e.jsx(c,{type:"submit",disabled:v.isLoading,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl px-8",children:v.isLoading?e.jsx(N,{className:"w-4 h-4 animate-spin"}):n?"Salvar Alterações":"Criar Trilha"})]})]})]})})]})};export{ue as default};
