import{f as $,n as H,b as K,o as _,r as n,p as b,q as w,j as e,B as i,v as o,a8 as G,e as l}from"./index-D96FZGJW.js";import{T as J,a as U,b as M,c as d,d as W,e as m}from"./table-S3G5nGeW.js";import{I as T}from"./input-DDdIEpJM.js";import{B as X}from"./badge-B3h_Dmat.js";import{C as Y,a as Z,b as ee,c as k,d as se}from"./card-DGXvG8EM.js";import{D as ae,b as te,c as re,d as ne,f as ie}from"./dialog-Bl-WjPsE.js";import{A as oe}from"./arrow-left-DuJ7_3jW.js";import{S as A}from"./search-Dt-WssL2.js";import{M as ce}from"./mail-CjevXRDO.js";import{T as le}from"./trash-2-CO8yHHry.js";import{C as de}from"./circle-check-BwwNu7gD.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ue=$("arrow-right-left",me),Ce=()=>{const{id:t}=H(),I=K(),u=_(),[j,L]=n.useState(""),[v,q]=n.useState("");n.useEffect(()=>{const s=setTimeout(()=>{q(j)},500);return()=>clearTimeout(s)},[j]);const{data:C,isLoading:R}=b({queryKey:["event",t],queryFn:async()=>(await l.get(`/events/${t}`)).data}),{data:f,isLoading:z}=b({queryKey:["event-enrollments",t],queryFn:async()=>{const a=(await l.get(`/enrollments/events/${t}`)).data;return Array.isArray(a)?a:a&&Array.isArray(a.enrollments)?a.enrollments:[]}}),g=(f==null?void 0:f.filter(s=>{if(!v)return!0;const a=v.toLowerCase();return s.user.name.toLowerCase().includes(a)||s.user.email.toLowerCase().includes(a)}))||[],E=w({mutationFn:async s=>{await l.post(`/enrollments/${s}/resend-confirmation`)},onSuccess:()=>{o.success("E-mail reenviado com sucesso!")},onError:s=>{var a,r;o.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Erro ao reenviar e-mail.")}}),B=s=>{window.confirm("Deseja reenviar o e-mail de confirmação para este usuário?")&&E.mutate(s)},S=w({mutationFn:async s=>{await l.delete(`/enrollments/${s}/permanent`)},onSuccess:()=>{o.success("Inscrição excluída permanentemente!"),u.invalidateQueries(["event-enrollments",t]),u.invalidateQueries(["event",t])},onError:s=>{var a,r;o.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Erro ao excluir participante.")}}),F=s=>{window.confirm("ATENÇÃO: Isso excluirá permanentemente a inscrição e liberará a vaga. Esta ação não pode ser desfeita. Deseja continuar?")&&S.mutate(s)},[P,x]=n.useState(!1),[h,O]=n.useState(null),[p,D]=n.useState(""),[N,Q]=n.useState(""),{data:c}=b({queryKey:["admin-events-list",N],queryFn:async()=>(await l.get("/events",{params:{search:N,limit:5}})).data.events,enabled:P}),y=w({mutationFn:async({enrollmentId:s,targetEventId:a})=>{await l.patch(`/enrollments/${s}/move`,{targetEventId:a})},onSuccess:()=>{o.success("Participante movido com sucesso!"),x(!1),D(""),u.invalidateQueries(["event-enrollments",t]),u.invalidateQueries(["event",t])},onError:s=>{var a,r;o.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Erro ao mover participante.")}}),V=s=>{O(s),x(!0)};return R?e.jsx("div",{className:"p-8 text-center",children:"Carregando evento..."}):C?e.jsxs("div",{className:"container mx-auto py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>I("/admin"),children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:C.title}),e.jsx("p",{className:"text-muted-foreground",children:"Gerenciamento de Inscrições"})]})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(ee,{children:["Participantes (",g.length,")"]}),e.jsx(k,{children:"Visualize e gerencie os inscritos neste evento."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Buscar por nome ou email...",className:"pl-8 w-[250px] or w-full",value:j,onChange:s=>L(s.target.value)})]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>o.info("Exportação em breve!"),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]})]})]})}),e.jsx(se,{children:z?e.jsx("div",{className:"p-8 text-center",children:"Carregando inscrições..."}):g.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:["Nenhuma inscrição encontrada",v&&" para a busca atual","."]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(U,{children:e.jsxs(M,{children:[e.jsx(d,{children:"Nome"}),e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Data Inscrição"}),e.jsx(d,{className:"text-right",children:"Ações"})]})}),e.jsx(W,{children:g.map(s=>e.jsxs(M,{children:[e.jsx(m,{className:"font-medium",children:s.user.name}),e.jsx(m,{children:s.user.email}),e.jsx(m,{children:e.jsx(X,{variant:s.status==="APPROVED"?"default":"secondary",children:s.status==="APPROVED"?"Confirmado":s.status})}),e.jsx(m,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="APPROVED"&&e.jsx(i,{size:"sm",variant:"outline",onClick:()=>B(s.id),disabled:E.isPending,title:"Reenviar E-mail de Confirmação",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",className:"text-blue-600 hover:text-blue-700",onClick:()=>V(s),title:"Mover Participante",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>F(s.id),disabled:S.isPending,title:"Excluir Participante (Libera Vaga)",children:e.jsx(le,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(ae,{open:P,onOpenChange:x,children:e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(re,{children:[e.jsx(ne,{children:"Mover Participante"}),e.jsxs(k,{children:["Selecione o evento de destino para ",e.jsx("strong",{children:h==null?void 0:h.user.name}),"."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar Evento de Destino"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Nome do evento...",className:"pl-8",value:N,onChange:s=>Q(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Selecione na lista:"}),e.jsxs("div",{className:"border rounded-md max-h-[200px] overflow-y-auto",children:[c==null?void 0:c.map(s=>e.jsxs("div",{className:`p-3 cursor-pointer hover:bg-muted border-b last:border-0 flex justify-between items-center ${p===s.id?"bg-muted border-primary":""}`,onClick:()=>D(s.id),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.location})]}),p===s.id&&e.jsx(de,{className:"h-4 w-4 text-primary"})]},s.id)),(c==null?void 0:c.length)===0&&e.jsx("p",{className:"p-4 text-center text-sm text-muted-foreground",children:"Nenhum evento encontrado."})]})]})]}),e.jsxs(ie,{children:[e.jsx(i,{variant:"ghost",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(i,{disabled:!p||y.isPending,onClick:()=>y.mutate({enrollmentId:h.id,targetEventId:p}),children:y.isPending?"Movendo...":"Confirmar Mudança"})]})]})})]}):e.jsx("div",{className:"p-8 text-center text-red-500",children:"Evento não encontrado."})};export{Ce as default};
