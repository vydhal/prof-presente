import{o as q,r as u,p as f,q as B,j as e,a9 as M,C as R,B as p,S as N,v as h,e as j}from"./index-BklJB83-.js";import{C as T,a as k,b as F,c as I,d as L}from"./card-DDG5aQ8T.js";import{L as C}from"./label-tnVTU4ew.js";import{T as P}from"./textarea-XiO_Vaua.js";import{D as O,g as Q,a as H,b as K,c as $,d as V}from"./dialog-0oblSlXr.js";import{B as z}from"./badge-nwE1jcP_.js";import{A as G,a as J}from"./alert-Bqlpc-Um.js";import{M as U}from"./map-pin-DL_mMyFw.js";const te=()=>{const D=q(),[c,o]=u.useState(null),[n,d]=u.useState(0),[g,m]=u.useState(""),[w,x]=u.useState(!1),{data:r,isLoading:b}=f({queryKey:["past-enrollments"],queryFn:async()=>{const a=await j.get("/enrollments"),t=new Date;return a.data.filter(s=>new Date(s.event.endDate)<t&&s.status==="confirmed")}}),{data:l}=f({queryKey:["my-evaluations"],queryFn:async()=>(await j.get("/evaluations/my")).data}),v=B({mutationFn:async a=>(await j.post("/evaluations",a)).data,onSuccess:()=>{D.invalidateQueries(["my-evaluations"]),h.success("Avaliação enviada com sucesso!"),x(!1),d(0),m(""),o(null)},onError:a=>{var t,s;h.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||"Erro ao enviar avaliação")}}),S=()=>{if(n===0){h.error("Por favor, selecione uma nota");return}v.mutate({eventId:c.event.id,rating:n,comment:g.trim()||null})},A=a=>new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"}),E=a=>l==null?void 0:l.some(t=>t.eventId===a),y=({value:a,onChange:t,readonly:s=!1})=>e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(i=>e.jsx("button",{type:"button",onClick:()=>!s&&t&&t(i),className:`transition-colors ${s?"cursor-default":"cursor-pointer hover:scale-110"}`,disabled:s,children:e.jsx(N,{className:`h-8 w-8 ${i<=a?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},i))});return b?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Avaliações"}),e.jsx("p",{className:"text-gray-600",children:"Avalie os eventos que você participou e veja suas avaliações anteriores"})]}),(r==null?void 0:r.length)===0&&e.jsxs(G,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(J,{children:"Você ainda não participou de nenhum evento para avaliar."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r==null?void 0:r.map(a=>{const t=E(a.event.id),s=l==null?void 0:l.find(i=>i.eventId===a.event.id);return e.jsxs(T,{children:[e.jsxs(k,{children:[e.jsx(F,{className:"text-lg",children:a.event.title}),e.jsx(I,{className:"line-clamp-2",children:a.event.description})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:A(a.event.startDate)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"line-clamp-1",children:a.event.location})]})]}),t?e.jsxs("div",{className:"space-y-3 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Sua avaliação:"}),e.jsx(z,{className:"bg-green-100 text-green-800",children:"Avaliado"})]}),e.jsx(y,{value:s.rating,readonly:!0}),s.comment&&e.jsxs("p",{className:"text-sm text-gray-600 italic",children:['"',s.comment,'"']})]}):e.jsxs(O,{open:w&&(c==null?void 0:c.id)===a.id,onOpenChange:i=>{x(i),i||(o(null),d(0),m(""))},children:[e.jsx(Q,{asChild:!0,children:e.jsxs(p,{className:"w-full",onClick:()=>o(a),children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Avaliar Evento"]})}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx($,{children:"Avaliar Evento"}),e.jsx(V,{children:a.event.title})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Sua nota"}),e.jsx(y,{value:n,onChange:d}),n>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:[n===1&&"Muito ruim",n===2&&"Ruim",n===3&&"Regular",n===4&&"Bom",n===5&&"Excelente"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"comment",children:"Comentário (opcional)"}),e.jsx(P,{id:"comment",placeholder:"Conte-nos sobre sua experiência...",value:g,onChange:i=>m(i.target.value),rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>{x(!1),o(null),d(0),m("")},children:"Cancelar"}),e.jsx(p,{onClick:S,disabled:v.isPending,children:v.isPending?"Enviando...":"Enviar Avaliação"})]})]})]})]})]})]},a.id)})})]})};export{te as default};
